---
import BaseLayout from "../../layouts/BaseLayout.astro"
import { getCollection, getEntry, render} from 'astro:content';
import BlogHeader from '../../components/blog/BlogHeader.tsx';

export async function getStaticPaths() {
  const pages = await getCollection('blog');

  return pages.map((page) => {
    return {params: {
      blogPost: page.data.slug,
    }, 
    props: {
      title: page.data.title,
      id: page.data.id,
      tags: page.data.tags,
    }}});
}

const { blogPost } = Astro.params;
const { title, id, tags } = Astro.props;

const formattedTitle = title ? `| ${title}` : '';

const entry = await getEntry('blog', id);

if (!entry) {
  throw new Error(`Blog post with id ${id} not found.`);
}

const { Content, headings } = await render(entry);

let defaultTags = tags || [];
---

<BaseLayout title={formattedTitle}>
  <article class="blogPost">
    <BlogHeader title={title} tags={defaultTags} />
    <Content />
  </article>
</BaseLayout>

<style>
  .blogPost {
    margin-top: 0.5rem;
    padding: 3rem;
    padding-top: 1rem;
    background-color: var(--background-color);
    border-radius: 10px 10px 10px 10px;
    height: fit-content;
  }
</style>